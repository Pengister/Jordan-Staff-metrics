<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Staff Performance Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">
  <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-8">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">
      Staff Performance Tracker
    </h1>

    <!-- LOGIN SECTION -->
    <div id="loginSection" class="space-y-4">
      <input 
        id="staffName" 
        type="text" 
        placeholder="Enter staff name" 
        class="border border-gray-300 w-full px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
      />
      <button 
        onclick="login()" 
        class="bg-blue-600 hover:bg-blue-700 text-white w-full py-2 rounded-lg font-medium"
      >
        View Dashboard
      </button>
    </div>

    <!-- DASHBOARD SECTION -->
    <div id="dashboardSection" class="hidden mt-8">
      <button 
        onclick="logout()" 
        class="text-sm text-gray-500 hover:underline mb-3"
      >‚Üê Back</button>

      <h2 id="dashboardTitle" class="text-xl font-semibold mb-4"></h2>

      <div id="dashboardContent" class="space-y-3 text-sm text-gray-700 bg-gray-50 p-4 rounded-lg overflow-auto" style="max-height: 300px;">
        <!-- Dashboard data will appear here -->
      </div>
    </div>

    <!-- STATUS OUTPUT -->
    <pre id="statusOutput" class="mt-6 text-xs text-gray-600 bg-gray-50 p-3 rounded-lg overflow-auto"></pre>
  </div>

  <script>
    // ‚öôÔ∏è REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL:
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw4_NXng8d2czUXMeIPeXsh84-qziNJuuw8oCtSnZK3eehHboDDuJKZkK9sPaElkt3V/exec";

    async function login() {
      const staffName = document.getElementById("staffName").value.trim();
      const output = document.getElementById("statusOutput");
      const dashboardSection = document.getElementById("dashboardSection");
      const loginSection = document.getElementById("loginSection");
      const dashboardContent = document.getElementById("dashboardContent");
      const dashboardTitle = document.getElementById("dashboardTitle");

      if (!staffName) {
        output.textContent = "‚ö†Ô∏è Please enter a staff name.";
        return;
      }

      const month = new Date().getMonth();
      const year = new Date().getFullYear();
      output.textContent = "‚è≥ Fetching dashboard data...";

      try {
        const response = await fetch(
          `${SCRIPT_URL}?action=getDashboardData&staffName=${encodeURIComponent(staffName)}&month=${month}&year=${year}`,
          {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          }
        );

        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const result = await response.json();

        if (result.error) throw new Error(result.error);

        dashboardContent.innerHTML = "";
        if (!result.data || result.data.length === 0) {
          dashboardContent.innerHTML = `<p>No records found for <strong>${staffName}</strong> this month.</p>`;
        } else {
          result.data.forEach((entry, index) => {
            const entryDiv = document.createElement("div");
            entryDiv.className = "p-3 border border-gray-200 bg-white rounded-lg";
            entryDiv.innerHTML = `
              <p class="font-semibold">üìÖ ${entry.Date}</p>
              <p>Clock In: ${entry.ClockInTime || "‚Äî"}</p>
              <p>Clock Out: ${entry.ClockOutTime || "‚Äî"}</p>
              <p>Dials: ${entry.Dials || 0}</p>
              <p>Presentations: ${entry.Presentations || 0}</p>
              <p>Binds: ${entry.Binds || 0}</p>
              <p>ALP: ${entry.ALP || 0}</p>
            `;
            dashboardContent.appendChild(entryDiv);
          });
        }

        dashboardTitle.textContent = `Dashboard for ${staffName}`;
        output.textContent = "‚úÖ Data loaded successfully.";

        // Show dashboard, hide login
        loginSection.classList.add("hidden");
        dashboardSection.classList.remove("hidden");
      } catch (err) {
        output.textContent = `‚ùå Failed to load data: ${err.message}`;
      }
    }

    function logout() {
      document.getElementById("dashboardSection").classList.add("hidden");
      document.getElementById("loginSection").classList.remove("hidden");
      document.getElementById("statusOutput").textContent = "";
      document.getElementById("staffName").value = "";
    }
  </script>
</body>
</html>
